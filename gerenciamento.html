<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <meta
            name="description"
            content="Sistema de gestão de loja de roupas - Controle de vendas e custos"
        />
        <meta name="theme-color" content="#dc3545" id="theme-color-meta" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta
            name="apple-mobile-web-app-status-bar-style"
            content="black-translucent"
        />
        <meta name="apple-mobile-web-app-title" content="Loja Vendas" />
        <title>Gestão Financeira</title>
        <!-- Google Fonts - Dancing Script (cursiva) -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">
        <!-- Preload CSS para evitar FOUC -->
        <link rel="preload" href="/css/style.css" as="style" />
        <link rel="stylesheet" href="/css/style.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" onload="window.chartJsLoaded = true;" onerror="console.error('Erro ao carregar Chart.js');"></script>
        <!-- QR Code Libraries -->
        <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
        <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
        <!-- Proteção de Código Fonte -->
        <script src="/js/protection.js"></script>
        <link rel="manifest" href="/manifest.json" />
        <link
            rel="icon"
            type="image/jpeg"
            sizes="192x192"
            href="/images/icone-e-transicao.jpg"
        />
        <link rel="apple-touch-icon" href="/images/icone-e-transicao.jpg" />
        <!-- Estilo inline para evitar FOUC - esconde conteúdo até CSS carregar -->
        <style>
            body { visibility: hidden; opacity: 0; }
            body.loaded { visibility: visible; opacity: 1; transition: opacity 0.2s; }
        </style>
        <script>
            // Mostrar conteúdo quando CSS carregar e aplicar animação de entrada
            window.addEventListener('load', function() {
                document.body.classList.add('loaded');
                
                // Aplicar animação de entrada na página de gerenciamento
                const appContainer = document.querySelector('.app-container');
                if (appContainer) {
                    // Pequeno delay para garantir que o CSS está carregado
                    setTimeout(() => {
                        appContainer.classList.add('animate-in');
                    }, 50);
                }
            });
        </script>
    </head>
    <body>
        <div class="app-container">
            <header class="header">
                <h1>Gestão Financeira</h1>
                <div class="header-actions">
                    <button id="helpBtn" class="btn-secondary" title="Como usar">
                        <i class="fas fa-question-circle"></i> <span class="btn-text">Como usar</span>
                    </button>
                    <button id="themeToggleBtn" class="theme-toggle-btn" title="Alternar tema">
                        <i class="fas fa-palette"></i>
                    </button>
                    <button id="importBtn" class="btn-secondary" title="Importar Dados">
                        <i class="fas fa-upload"></i> <span class="btn-text">Importar Dados</span>
                    </button>
                    <button id="exportBtn" class="btn-secondary" title="Exportar Dados">
                        <i class="fas fa-download"></i> <span class="btn-text">Exportar Dados</span>
                    </button>
                    <input
                        type="file"
                        id="importFile"
                        accept=".txt"
                        style="display: none"
                    />
                    <button type="button" id="logoutBtn" class="btn-secondary" title="Sair">
                        <i class="fas fa-sign-out-alt"></i> <span class="btn-text">Sair</span>
                    </button>
                </div>
            </header>

            <main class="main-content">
                <div class="toolbar" id="mainToolbar" style="display: none;">
                    <div class="search-filter">
                        <div style="position: relative; flex: 1;">
                            <i class="fas fa-search" style="position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--gray-400); pointer-events: none;"></i>
                            <input
                                type="text"
                                id="searchInput"
                                placeholder="Pesquisar..."
                                style="padding-left: 2.5rem;"
                            />
                        </div>
                        <select id="monthFilter">
                            <option value="">Todos os meses</option>
                        </select>
                    </div>
                </div>

                <div class="content-tabs">
                    <!-- Dashboards agrupados -->
                    <button class="tab-btn" id="dashboardToggleBtn" data-tab="dashboard" title="Dashboards">
                        <i class="fas fa-chart-line"></i> <span class="btn-text">Dashboards</span>
                    </button>
                    <button class="tab-btn" data-tab="salesPanel" title="Painel de Vendas">
                        <i class="fas fa-shopping-cart"></i> <span class="btn-text">Painel de Vendas</span>
                    </button>
                    <button class="tab-btn" data-tab="servicesPanel" title="Painel de Serviços">
                        <i class="fas fa-briefcase"></i> <span class="btn-text">Painel de Serviços</span>
                    </button>
                    <button class="tab-btn" data-tab="goals" title="Metas">
                        <i class="fas fa-bullseye"></i> <span class="btn-text">Metas</span>
                    </button>
                </div>

                <!-- Tab: Painel de Vendas -->
                <div id="salesPanelTab" class="tab-content active">
                    <div class="sales-panel-layout">
                        <!-- Seção de Grupos Mensais -->
                        <div class="panel-section">
                            <div class="panel-header">
                                <h2><i class="fas fa-calendar-check"></i> Grupos Mensais</h2>
                                <button class="btn-primary" onclick="app.openGroupModal()">
                                    <i class="fas fa-plus"></i> Novo Mês
                                </button>
                            </div>
                            <div id="groupsList" class="groups-list">
                                <!-- Grupos mensais serão inseridos aqui via JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Seção de Produtos -->
                        <div class="panel-section">
                            <div class="panel-header">
                                <h2><i class="fas fa-box"></i> Produtos</h2>
                                <button class="btn-primary" onclick="app.openItemModal()">
                                    <i class="fas fa-plus"></i> Novo Produto
                                </button>
                            </div>
                            <div id="itemsGrid" class="items-grid">
                                <!-- Produtos serão inseridos aqui via JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Seção de Pedidos Pendentes -->
                        <div class="panel-section">
                            <div class="panel-header">
                                <h2><i class="fas fa-clock"></i> Pedidos Pendentes</h2>
                                <button class="btn-primary" onclick="app.openPendingOrderModal()">
                                    <i class="fas fa-plus"></i> Novo Pedido
                                </button>
                            </div>
                            <div id="pendingOrdersList" class="pending-orders-list">
                                <!-- Pedidos pendentes serão inseridos aqui via JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Seção de Custos de Compra -->
                        <div class="panel-section">
                            <div class="panel-header">
                                <h2><i class="fas fa-receipt"></i> Custos de Compra</h2>
                                <button class="btn-primary" onclick="app.openCostModal()">
                                    <i class="fas fa-plus"></i> Novo Custo
                                </button>
                            </div>
                            <div class="costs-layout">
                                <div class="costs-summary-card">
                                    <h3>Resumo de Custos</h3>
                                    <div class="summary-stats">
                                        <div class="stat-item">
                                            <h4>Total de Custos</h4>
                                            <p id="totalCostsCount">0</p>
                                        </div>
                                        <div class="stat-item">
                                            <h4>Valor Total</h4>
                                            <p id="totalCostsValue">R$ 0,00</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Gráfico de Custos -->
                                    <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                                        <h4 style="margin-bottom: 1rem; font-size: 1rem; color: var(--gray-600);">Evolução de Custos</h4>
                                        <div class="chart-wrapper" style="height: 200px;">
                                            <canvas id="costsChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="costs-content">
                                    <div id="costsList" class="costs-list">
                                        <!-- Custos serão inseridos aqui via JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Dashboard Vendas -->
                <div id="dashboardTab" class="tab-content">
                    <div class="dashboard-container">
                        <div class="dashboard-filters">
                            <div class="filter-group">
                                <label for="periodFilter">Período:</label>
                                <select id="periodFilter" class="filter-select">
                                    <option value="all">Todos os períodos</option>
                                    <option value="month">Último mês</option>
                                    <option value="3months">Últimos 3 meses</option>
                                    <option value="6months">Últimos 6 meses</option>
                                    <option value="year">Último ano</option>
                                </select>
                            </div>
                            <button type="button" class="btn-secondary" id="refreshDashboard">
                                <i class="fas fa-sync-alt"></i> Atualizar Gráficos
                            </button>
                        </div>

                        <div class="charts-grid">
                            <div class="chart-card">
                                <h3>Vendas por Mês</h3>
                                <div class="chart-wrapper">
                                    <canvas id="salesByMonthChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <h3>Lucro vs Custos</h3>
                                <div class="chart-wrapper">
                                    <canvas id="profitVsCostsChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <h3>Top 10 Itens Mais Vendidos</h3>
                                <div class="chart-wrapper">
                                    <canvas id="topItemsChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <h3>Evolução do Lucro</h3>
                                <div class="chart-wrapper">
                                    <canvas id="profitEvolutionChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <h3>Consumo de Estoque por Mês</h3>
                                <div class="chart-wrapper">
                                    <canvas id="stockConsumptionChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <h3>Top 10 Itens em Rotatividade</h3>
                                <div class="chart-wrapper">
                                    <canvas id="stockRotationChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-stats">
                            <div class="stat-card">
                                <h4>Média Mensal de Vendas</h4>
                                <p id="avgMonthlySales">R$ 0,00</p>
                            </div>
                            <div class="stat-card">
                                <h4>Melhor Mês</h4>
                                <p id="bestMonth">-</p>
                            </div>
                            <div class="stat-card">
                                <h4>Margem de Lucro Média</h4>
                                <p id="avgProfitMargin">0%</p>
                            </div>
                            <div class="stat-card">
                                <h4>Total de Itens Cadastrados</h4>
                                <p id="totalItemsCount">0</p>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Tab: Dashboard Serviços -->
                <div id="servicesDashboardTab" class="tab-content">
                    <div class="dashboard-container">
                        <div class="dashboard-filters">
                            <div class="filter-group">
                                <label for="servicesPeriodFilter">Período:</label>
                                <select id="servicesPeriodFilter" class="filter-select">
                                    <option value="all">Todos os períodos</option>
                                    <option value="month">Último mês</option>
                                    <option value="3months">Últimos 3 meses</option>
                                    <option value="6months">Últimos 6 meses</option>
                                    <option value="year">Último ano</option>
                                </select>
                            </div>
                            <button type="button" class="btn-secondary" id="refreshServicesDashboard">
                                <i class="fas fa-sync-alt"></i> Atualizar Gráficos
                            </button>
                        </div>

                        <div class="charts-grid">
                            <div class="chart-card">
                                <h3>Horas Trabalhadas por Mês</h3>
                                <div class="chart-wrapper">
                                    <canvas id="hoursByMonthChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <h3>Faturamento por Mês</h3>
                                <div class="chart-wrapper">
                                    <canvas id="revenueByMonthChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <h3>Top 10 Serviços Mais Prestados</h3>
                                <div class="chart-wrapper">
                                    <canvas id="topServicesChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <h3>Evolução de Horas Trabalhadas</h3>
                                <div class="chart-wrapper">
                                    <canvas id="hoursEvolutionChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <h3>Média de Horas por Dia</h3>
                                <div class="chart-wrapper">
                                    <canvas id="avgHoursPerDayChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <h3>Valor Médio por Hora</h3>
                                <div class="chart-wrapper">
                                    <canvas id="avgValuePerHourChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-stats">
                            <div class="stat-card">
                                <h4>Média Mensal de Horas</h4>
                                <p id="servicesAvgMonthlyHours">0h 0min</p>
                            </div>
                            <div class="stat-card">
                                <h4>Melhor Mês (Horas)</h4>
                                <p id="servicesBestMonthHours">-</p>
                            </div>
                            <div class="stat-card">
                                <h4>Média Mensal de Faturamento</h4>
                                <p id="servicesAvgMonthlyRevenue">R$ 0,00</p>
                            </div>
                            <div class="stat-card">
                                <h4>Melhor Mês (Faturamento)</h4>
                                <p id="servicesBestMonthRevenue">-</p>
                            </div>
                            <div class="stat-card">
                                <h4>Valor Médio por Hora</h4>
                                <p id="servicesAvgValuePerHour">R$ 0,00</p>
                            </div>
                            <div class="stat-card">
                                <h4>Total de Serviços Prestados</h4>
                                <p id="servicesTotalServices">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Painel de Serviços -->
                <div id="servicesPanelTab" class="tab-content">
                    <div class="services-panel-layout">
                        <!-- Seção de Agenda de Serviços -->
                        <div class="panel-section">
                            <div class="panel-header">
                                <h2><i class="fas fa-calendar-alt"></i> Agenda de Serviços</h2>
                                <button class="btn-primary" onclick="app.openServiceAppointmentModal()">
                                    <i class="fas fa-plus"></i> Novo Agendamento
                                </button>
                            </div>
                            <div id="serviceAppointmentsList" class="service-appointments-list">
                                <!-- Agendamentos serão inseridos aqui via JavaScript -->
                            </div>
                        </div>
                    </div>
                    <div class="services-layout">
                        <div class="overall-summary-card">
                            <h3>Resumo de Serviços</h3>
                            <div class="summary-stats">
                                <div class="stat-item">
                                    <h4>Total de Horas</h4>
                                    <p id="servicesTotalHours">0h 0min</p>
                                </div>
                                <div class="stat-item">
                                    <h4>Média de Horas/Mês</h4>
                                    <p id="servicesAvgHours">0h 0min</p>
                                </div>
                                <div class="stat-item" style="background: #fff3cd; border: 1px solid #ffc107;">
                                    <h4>Total Faturado</h4>
                                    <p id="servicesTotalRevenue" style="color: #856404">R$ 0,00</p>
                                </div>
                                <div class="stat-item" style="background: #d4edda; border: 1px solid #28a745;">
                                    <h4>Serviços Registrados</h4>
                                    <p id="servicesTotalCount" style="color: #155724; font-size: 1.6rem;">0</p>
                                </div>
                                <div class="stat-item" style="background: #e7f3ff; border: 1px solid #007bff;">
                                    <h4>Valor Médio por Hora</h4>
                                    <p id="servicesAvgValuePerHour" style="color: #004085;">R$ 0,00</p>
                                </div>
                                <div class="stat-item" style="background: #f8d7da; border: 1px solid #dc3545;">
                                    <h4>Média de Horas por Serviço</h4>
                                    <p id="servicesAvgHoursPerService" style="color: #721c24;">0h 0min</p>
                                </div>
                            </div>
                            
                            <!-- Gráfico de Serviços -->
                            <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                                <h4 style="margin-bottom: 1rem; font-size: 1rem; color: var(--gray-600);">Evolução de Serviços por Mês</h4>
                                <div class="chart-wrapper" style="height: 200px;">
                                    <canvas id="servicesChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="groups-content">
                            <div class="toolbar">
                                <button type="button" id="newServiceGroupBtn" class="btn-primary">
                                    <i class="fas fa-calendar-plus"></i> Novo Mês de Serviços
                                </button>
                            </div>
                            <div id="servicesList" class="groups-list">
                                <!-- Serviços mensais serão inseridos aqui via JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Metas -->
                <div id="goalsTab" class="tab-content">
                    <div class="goals-layout">
                        <div class="goals-summary-card">
                            <h3>Resumo de Metas</h3>
                            <div class="summary-stats">
                                <div class="stat-item">
                                    <h4>Meta do Mês Atual</h4>
                                    <p id="currentMonthGoal">R$ 0,00</p>
                                </div>
                                <div class="stat-item">
                                    <h4>Vendas do Mês</h4>
                                    <p id="currentMonthSales">R$ 0,00</p>
                                </div>
                                <div class="stat-item" id="goalProgressItem">
                                    <h4>Progresso</h4>
                                    <p id="goalProgress">0%</p>
                                </div>
                                <div class="stat-item" id="goalStatusItem">
                                    <h4>Status</h4>
                                    <p id="goalStatus">-</p>
                                </div>
                            </div>
                            
                            <!-- Gráfico de Metas -->
                            <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                                <h4 style="margin-bottom: 1rem; font-size: 1rem; color: var(--gray-600);">Evolução de Metas vs Vendas</h4>
                                <div class="chart-wrapper" style="height: 200px;">
                                    <canvas id="goalsChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="goals-content">
                            <div class="toolbar-goals">
                                <button type="button" id="newGoalBtn" class="btn-primary">
                                    <i class="fas fa-bullseye"></i> Criar Nova Meta
                                </button>
                            </div>
                            <div id="goalsList" class="goals-list">
                                <!-- Metas serão inseridas aqui via JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <footer class="footer">
                <p class="footer-text-cursive">Gerenciamento</p>
            </footer>
        </div>

        <!-- Modal: Cadastro/Edição de Item -->
        <div id="itemModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">Novo Produto</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <form id="itemForm">
                    <div class="form-group">
                        <label for="itemCategory">Categoria *</label>
                        <select id="itemCategory" required>
                            <option value="">Selecione...</option>
                            <option value="Roupas">Roupas</option>
                            <option value="Eletrônicos">Eletrônicos</option>
                            <option value="Serviços">Serviços</option>
                        </select>
                    </div>
                    <!-- Campos para Roupas (Nome e Marca) -->
                    <div id="clothingBasicFields">
                        <div class="form-group">
                            <label for="itemName">Nome da Roupa (opcional)</label>
                            <input type="text" id="itemName" placeholder="Ex: Camiseta, Calça, etc." />
                        </div>
                        <div class="form-group">
                            <label for="itemBrand">Marca *</label>
                            <input type="text" id="itemBrand" required />
                        </div>
                    </div>
                    
                    <!-- Campos específicos para Roupas -->
                    <div id="clothingFields" class="category-specific-fields" style="display: none;">
                        <div class="form-group">
                            <label for="itemStyle">Estilo da Roupa (opcional)</label>
                            <input type="text" id="itemStyle" placeholder="Ex: Casual, Esportivo, Social, etc." />
                        </div>
                        <div class="form-group">
                            <label for="itemSize">Tamanho (opcional)</label>
                            <input type="text" id="itemSize" placeholder="Ex: P, M, G, 42, etc." />
                        </div>
                        <div class="form-group">
                            <label for="itemGender">Gênero (opcional)</label>
                            <select id="itemGender">
                                <option value="">Selecione...</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Feminino">Feminino</option>
                                <option value="Unissex">Unissex</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Campos específicos para Eletrônicos -->
                    <div id="electronicsFields" class="category-specific-fields" style="display: none;">
                        <div class="form-group">
                            <label for="itemModel">Modelo (opcional)</label>
                            <input type="text" id="itemModel" placeholder="Ex: iPhone 14, Galaxy S23, etc." />
                        </div>
                        <div class="form-group">
                            <label for="itemCapacity">Capacidade (opcional)</label>
                            <input type="text" id="itemCapacity" placeholder="Ex: 128GB, 256GB, 512GB, etc." />
                        </div>
                        <div class="form-group">
                            <label for="itemColor">Cor (opcional)</label>
                            <input type="text" id="itemColor" placeholder="Ex: Preto, Branco, Azul, etc." />
                        </div>
                    </div>
                    
                    <!-- Campos específicos para Serviços -->
                    <div id="servicesFields" class="category-specific-fields" style="display: none;">
                        <div class="form-group">
                            <label for="serviceName">Nome do Serviço *</label>
                            <input type="text" id="serviceName" placeholder="Ex: Consulta Médica, Aula de Inglês, etc." required />
                        </div>
                        <div class="form-group">
                            <label for="serviceDescription">Descrição (opcional)</label>
                            <textarea id="serviceDescription" rows="3" placeholder="Descreva o serviço oferecido..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="serviceDuration">Duração (opcional)</label>
                            <input type="text" id="serviceDuration" placeholder="Ex: 1 hora, 30 minutos, etc." />
                        </div>
                        <div class="form-group">
                            <label for="serviceType">Tipo de Serviço (opcional)</label>
                            <select id="serviceType">
                                <option value="">Selecione...</option>
                                <option value="Consultoria">Consultoria</option>
                                <option value="Aula/Ensino">Aula/Ensino</option>
                                <option value="Reparo/Manutenção">Reparo/Manutenção</option>
                                <option value="Design/Criação">Design/Criação</option>
                                <option value="Saúde/Beleza">Saúde/Beleza</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="serviceUnit">Unidade de Venda (opcional)</label>
                            <select id="serviceUnit">
                                <option value="Horas">Horas</option>
                                <option value="Sessões">Sessões</option>
                                <option value="Atendimentos">Atendimentos</option>
                                <option value="Unidades">Unidades</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="serviceDefaultHours">Horas Padrão (opcional)</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input
                                    type="number"
                                    id="serviceDefaultHours"
                                    min="0"
                                    placeholder="Horas"
                                    style="flex: 1;"
                                />
                                <input
                                    type="number"
                                    id="serviceDefaultMinutes"
                                    min="0"
                                    max="59"
                                    placeholder="Minutos"
                                    style="flex: 1;"
                                />
                            </div>
                            <small style="color: var(--gray); display: block; margin-top: 0.25rem;">
                                Horas padrão que serão usadas ao registrar o serviço no mês
                            </small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="itemPrice">Preço *</label>
                        <input
                            type="number"
                            id="itemPrice"
                            step="0.01"
                            min="0.01"
                            required
                        />
                    </div>
                    <!-- QR Code Section -->
                    <div class="form-group" id="qrcodeSection" style="display: none; background: var(--light-gray); padding: 1rem; border-radius: 5px; margin-top: 1rem;">
                        <label style="margin-bottom: 0.5rem; display: block;">QR Code do Produto</label>
                        <div id="qrcodeContainer" style="text-align: center;">
                            <canvas id="qrcodeCanvas" style="max-width: 100%; height: auto;"></canvas>
                            <div style="margin-top: 1rem; display: flex; gap: 0.5rem; justify-content: center;">
                                <button type="button" class="btn-secondary" id="downloadQRBtn">
                                    <i class="fas fa-download"></i> Baixar
                                </button>
                                <button type="button" class="btn-secondary" id="printQRBtn">
                                    <i class="fas fa-print"></i> Imprimir
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button
                            type="button"
                            class="btn-secondary"
                            id="cancelBtn"
                        >
                            Cancelar
                        </button>
                        <button type="submit" class="btn-primary">
                            Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>


        <!-- Modal: Registrar Venda -->
        <div id="saleModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Registrar Venda</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <form id="saleForm">
                    <div class="form-group" id="saleDayInfo" style="background: var(--light-gray); padding: 10px; border-radius: 5px; margin-bottom: 15px; text-align: center;">
                        <strong>Dia: <span id="saleDayDisplay">-</span></strong>
                    </div>
                    <div class="form-group">
                        <label for="saleCustomerName">Nome do Cliente *</label>
                        <input
                            type="text"
                            id="saleCustomerName"
                            placeholder="Digite o nome do cliente"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="saleCustomerCPF">CPF do Cliente</label>
                        <input
                            type="text"
                            id="saleCustomerCPF"
                            placeholder="000.000.000-00"
                            maxlength="14"
                        />
                    </div>
                    <div class="form-group">
                        <label for="saleItem">Item *</label>
                        <div style="display: flex; gap: 0.5rem; align-items: flex-start;">
                            <select id="saleItem" required style="flex: 1;">
                                <option value="">Selecione um item...</option>
                            </select>
                            <button type="button" class="btn-secondary" id="scanQRBtn" title="Escanear QR Code" aria-label="Escanear QR Code do produto" style="white-space: nowrap;">
                                <i class="fas fa-qrcode"></i>
                            </button>
                        </div>
                        <div id="qrScannerContainer" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--light-gray); border-radius: 5px;">
                            <div id="qrReader" style="width: 100%; max-width: 400px; margin: 0 auto;"></div>
                            <button type="button" class="btn-secondary" id="stopScanBtn" style="margin-top: 1rem; width: 100%;">
                                <i class="fas fa-stop"></i> Parar Escaneamento
                            </button>
                        </div>
                        <!-- Info do serviço (só aparece para serviços) -->
                        <div id="serviceInfo" style="display: none; margin-top: 0.75rem; padding: 0.75rem; background: #e7f3ff; border-radius: 5px; border-left: 3px solid #28a745;">
                            <small id="serviceDescriptionText" style="color: #155724; display: block;"></small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="saleQuantity" id="saleQuantityLabel">Quantidade *</label>
                        <input
                            type="number"
                            id="saleQuantity"
                            min="1"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="salePrice">Preço Aplicado *</label>
                        <input
                            type="number"
                            id="salePrice"
                            step="0.01"
                            min="0.01"
                            required
                        />
                    </div>
                    <div class="modal-actions">
                        <button
                            type="button"
                            class="btn-secondary"
                            id="cancelSaleBtn"
                        >
                            Cancelar
                        </button>
                        <button type="submit" class="btn-primary">
                            Registrar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal: Preview de Recibo -->
        <div id="receiptPreviewModal" class="modal">
            <div class="modal-content large">
                <div class="modal-header">
                    <h2>Recibo de Venda</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <div class="receipt-content" id="receiptContent">
                    <!-- Conteúdo do recibo será inserido via JavaScript -->
                </div>
                <div class="modal-actions" style="margin-top: 1.5rem;">
                    <button type="button" class="btn-secondary" id="closeReceiptBtn">
                        Fechar
                    </button>
                    <button type="button" class="btn-primary" id="printReceiptBtn">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Pedido Pendente -->
        <div id="pendingOrderModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="pendingOrderModalTitle">Novo Pedido Pendente</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <form id="pendingOrderForm">
                    <div class="form-group">
                        <label for="pendingOrderCustomerName">Nome do Cliente *</label>
                        <input
                            type="text"
                            id="pendingOrderCustomerName"
                            placeholder="Digite o nome do cliente"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="pendingOrderCustomerCPF">CPF do Cliente</label>
                        <input
                            type="text"
                            id="pendingOrderCustomerCPF"
                            placeholder="000.000.000-00"
                            maxlength="14"
                        />
                    </div>
                    <div class="form-group">
                        <label for="pendingOrderItems">Itens *</label>
                        <div id="pendingOrderItemsList" style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <!-- Itens serão adicionados dinamicamente -->
                        </div>
                        <button type="button" class="btn-secondary" id="addPendingOrderItemBtn" style="margin-top: 0.5rem;">
                            <i class="fas fa-plus"></i> Adicionar Item
                        </button>
                    </div>
                    <div class="form-group">
                        <label for="pendingOrderTotal">Valor Total (R$)</label>
                        <input
                            type="number"
                            id="pendingOrderTotal"
                            step="0.01"
                            min="0.01"
                            readonly
                            style="background: var(--light-gray)"
                        />
                    </div>
                    <div class="form-group">
                        <label for="pendingOrderStatus">Status *</label>
                        <select id="pendingOrderStatus" required>
                            <option value="pending">Pendente</option>
                            <option value="confirmed">Confirmado</option>
                            <option value="cancelled">Cancelado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pendingOrderDueDate">Data de Vencimento</label>
                        <input type="date" id="pendingOrderDueDate" />
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" id="cancelPendingOrderBtn">
                            Cancelar
                        </button>
                        <button type="submit" class="btn-primary">
                            Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal: Agendamento de Serviço -->
        <div id="serviceAppointmentModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="serviceAppointmentModalTitle">Novo Agendamento</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <form id="serviceAppointmentForm">
                    <div class="form-group">
                        <label for="appointmentServiceType">Tipo de Serviço *</label>
                        <select id="appointmentServiceType" required>
                            <option value="">Selecione um serviço...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="appointmentCustomerName">Nome do Cliente *</label>
                        <input
                            type="text"
                            id="appointmentCustomerName"
                            placeholder="Digite o nome do cliente"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="appointmentCustomerContact">Contato do Cliente</label>
                        <input
                            type="text"
                            id="appointmentCustomerContact"
                            placeholder="Telefone ou e-mail"
                        />
                    </div>
                    <div class="form-group">
                        <label for="appointmentDate">Data *</label>
                        <input type="date" id="appointmentDate" required />
                    </div>
                    <div class="form-group">
                        <label for="appointmentTime">Horário *</label>
                        <input type="time" id="appointmentTime" required />
                    </div>
                    <div class="form-group">
                        <label for="appointmentPrice">Preço (R$) *</label>
                        <input
                            type="number"
                            id="appointmentPrice"
                            step="0.01"
                            min="0.01"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="appointmentStatus">Status *</label>
                        <select id="appointmentStatus" required>
                            <option value="pending">Pendente</option>
                            <option value="confirmed">Confirmado</option>
                            <option value="completed">Concluído</option>
                            <option value="cancelled">Cancelado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="appointmentNotes">Observações</label>
                        <textarea
                            id="appointmentNotes"
                            rows="3"
                            placeholder="Observações sobre o agendamento..."
                        ></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" id="cancelServiceAppointmentBtn">
                            Cancelar
                        </button>
                        <button type="submit" class="btn-primary">
                            Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal: Criar Grupo Mensal -->
        <div id="groupModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Novo Grupo Mensal</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <form id="groupForm">
                    <div class="form-group">
                        <label for="groupMonth">Mês/Ano *</label>
                        <input type="month" id="groupMonth" required />
                    </div>
                    <div class="modal-actions">
                        <button
                            type="button"
                            class="btn-secondary"
                            id="cancelGroupBtn"
                        >
                            Cancelar
                        </button>
                        <button type="submit" class="btn-primary">
                            Criar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal: Visualizar/Editar Grupo -->
        <div id="viewGroupModal" class="modal">
            <div class="modal-content large">
                <div class="modal-header">
                    <h2 id="groupTitle">Grupo Mensal</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <div class="group-content">
                    <div class="group-summary">
                        <div class="summary-card">
                            <h3>Total de Vendas (Mês)</h3>
                            <p id="totalSales">0</p>
                        </div>
                        <div class="summary-card">
                            <h3>Valor Total (Mês)</h3>
                            <p id="totalValue">R$ 0,00</p>
                        </div>
                        <div
                            class="summary-card"
                            style="
                                background: #fff3cd;
                                border: 2px solid #ffc107;
                            "
                        >
                            <h3>Total de Vendas (Todos os Meses)</h3>
                            <p
                                id="totalSalesAll"
                                style="
                                    color: #856404;
                                    font-size: 1.8rem;
                                    font-weight: bold;
                                "
                            >
                                0
                            </p>
                        </div>
                        <div
                            class="summary-card"
                            style="
                                background: #fff3cd;
                                border: 2px solid #ffc107;
                            "
                        >
                            <h3>Valor Total (Todos os Meses)</h3>
                            <p
                                id="totalValueAll"
                                style="
                                    color: #856404;
                                    font-size: 1.8rem;
                                    font-weight: bold;
                                "
                            >
                                R$ 0,00
                            </p>
                        </div>
                    </div>
                    <div class="stock-summary-card" style="margin: 1.5rem 0; padding: 1.5rem; background: #f8f9fa; border-radius: 8px; border: 2px solid #17a2b8;">
                        <h3 style="margin-bottom: 1rem; color: #0c5460;">📦 Resumo de Estoque do Mês</h3>
                        <div class="summary-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div class="stat-item" style="background: #e7f3ff; border: 2px solid #17a2b8; padding: 1rem; border-radius: 8px;">
                                <h4 style="margin: 0 0 0.5rem 0; color: #0c5460; font-size: 0.9rem;">Estoque Total</h4>
                                <p id="groupStockTotal" style="margin: 0; color: #0c5460; font-size: 1.5rem; font-weight: bold;">0 un.</p>
                            </div>
                            <div class="stat-item" style="background: #fff3cd; border: 2px solid #ffc107; padding: 1rem; border-radius: 8px;">
                                <h4 style="margin: 0 0 0.5rem 0; color: #856404; font-size: 0.9rem;">Estoque Vendido</h4>
                                <p id="groupStockSold" style="margin: 0; color: #856404; font-size: 1.5rem; font-weight: bold;">0 un.</p>
                            </div>
                            <div class="stat-item" style="background: #d4edda; border: 2px solid #28a745; padding: 1rem; border-radius: 8px;">
                                <h4 style="margin: 0 0 0.5rem 0; color: #155724; font-size: 0.9rem;">Estoque Disponível</h4>
                                <p id="groupStockAvailable" style="margin: 0; color: #155724; font-size: 1.5rem; font-weight: bold;">0 un.</p>
                            </div>
                            <div class="stat-item" id="groupLowStockAlert" style="display: none; background: #f8d7da; border: 2px solid #dc3545; padding: 1rem; border-radius: 8px;">
                                <h4 style="margin: 0 0 0.5rem 0; color: #721c24; font-size: 0.9rem;">⚠️ Alerta: Estoque Baixo</h4>
                                <p id="groupLowStockItems" style="margin: 0; color: #721c24; font-size: 1rem;">-</p>
                            </div>
                        </div>
                    </div>
                    <div class="days-container">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3>Vendas por Dia</h3>
                            <button type="button" class="btn-primary" id="manageStockBtn" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <i class="fas fa-warehouse"></i> Gerenciar Estoque do Dia
                            </button>
                        </div>
                        <div id="daysList" class="days-list">
                            <!-- Dias serão inseridos aqui -->
                        </div>
                    </div>
                    <div class="items-summary">
                        <h3>Resumo por Item</h3>
                        <div id="itemsSummary" class="items-summary-list">
                            <!-- Resumo será inserido aqui -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal: Cadastrar Custo de Compra -->
        <div id="costModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="costModalTitle">Cadastrar Novo Custo</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <form id="costForm">
                    <div class="form-group">
                        <label for="costItem">Item *</label>
                        <select id="costItem" required>
                            <option value="">Selecione um item...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="costDate">Data da Compra *</label>
                        <input type="date" id="costDate" required />
                    </div>
                    <div class="form-group">
                        <label for="costQuantity">Quantidade *</label>
                        <input
                            type="number"
                            id="costQuantity"
                            min="1"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="costPrice">Custo Unitário *</label>
                        <input
                            type="number"
                            id="costPrice"
                            step="0.01"
                            min="0.01"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="costTotal">Custo Total</label>
                        <input
                            type="number"
                            id="costTotal"
                            step="0.01"
                            readonly
                            style="background: var(--light-gray)"
                        />
                    </div>
                    <div class="modal-actions">
                        <button
                            type="button"
                            class="btn-secondary"
                            id="cancelCostBtn"
                        >
                            Cancelar
                        </button>
                        <button type="submit" class="btn-primary">
                            Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal: Gerenciar Estoque do Dia -->
        <div id="stockModal" class="modal">
            <div class="modal-content large">
                <div class="modal-header">
                    <h2 id="stockModalTitle">Gerenciar Estoque do Dia</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <div class="stock-content">
                    <div class="form-group">
                        <label for="stockDay">Dia *</label>
                        <input type="number" id="stockDay" min="1" max="31" required />
                    </div>
                    <div class="stock-items-list" id="stockItemsList">
                        <!-- Itens com estoque serão inseridos aqui -->
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancelStockBtn">
                        Cancelar
                    </button>
                    <button type="button" class="btn-primary" id="saveStockBtn">
                        Salvar Estoque
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Gerenciar Estoque do Dia -->
        <div id="stockModal" class="modal">
            <div class="modal-content large">
                <div class="modal-header">
                    <h2 id="stockModalTitle">Gerenciar Estoque do Dia</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <div class="stock-content">
                    <div class="form-group">
                        <label for="stockDay">Dia *</label>
                        <input type="number" id="stockDay" min="1" max="31" required />
                    </div>
                    <div class="stock-items-list" id="stockItemsList" style="max-height: 400px; overflow-y: auto; margin-top: 1rem;">
                        <!-- Itens com estoque serão inseridos aqui -->
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancelStockBtn">
                        Cancelar
                    </button>
                    <button type="button" class="btn-primary" id="saveStockBtn">
                        Salvar Estoque
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Criar Mês de Serviços -->
        <div id="serviceGroupModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Novo Mês de Serviços</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <form id="serviceGroupForm">
                    <div class="form-group">
                        <label for="serviceGroupMonth">Mês/Ano *</label>
                        <input type="month" id="serviceGroupMonth" required />
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" id="cancelServiceGroupBtn">
                            Cancelar
                        </button>
                        <button type="submit" class="btn-primary">Criar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal: Registrar Serviço no Mês -->
        <div id="serviceRecordModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Registrar Serviço</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <form id="serviceRecordForm">
                    <div class="form-group" id="serviceRecordDayInfo" style="background: var(--light-gray); padding: 0.75rem; border-radius: 5px; margin-bottom: 1rem; text-align: center;">
                        <strong>Dia: <span id="serviceRecordDayDisplay">-</span></strong>
                    </div>
                    <div class="form-group">
                        <label for="serviceRecordItem">Serviço *</label>
                        <select id="serviceRecordItem" required>
                            <option value="">Selecione um serviço...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="serviceRecordHours">Horas Trabalhadas *</label>
                        <div style="display: flex; gap: 0.5rem; align-items: center; justify-content: center;">
                            <input
                                type="number"
                                id="serviceRecordHours"
                                min="0"
                                placeholder="Horas"
                                required
                                style="flex: 1; max-width: 120px;"
                            />
                            <span style="font-weight: bold;">:</span>
                            <input
                                type="number"
                                id="serviceRecordMinutes"
                                min="0"
                                max="59"
                                placeholder="Minutos"
                                required
                                style="flex: 1; max-width: 120px;"
                            />
                        </div>
                        <small style="color: var(--gray); display: block; margin-top: 0.25rem; text-align: center;">
                            Use as horas padrão do serviço ou informe manualmente
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="serviceRecordPrice">Preço Aplicado (R$) *</label>
                        <input
                            type="number"
                            id="serviceRecordPrice"
                            step="0.01"
                            min="0.01"
                            required
                        />
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" id="cancelServiceRecordBtn">
                            Cancelar
                        </button>
                        <button type="submit" class="btn-primary">
                            Registrar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal: Visualizar Serviços do Mês -->
        <div id="viewServiceGroupModal" class="modal">
            <div class="modal-content large">
                <div class="modal-header">
                    <h2 id="serviceGroupTitle">Serviços do Mês</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <div class="service-group-content">
                    <div class="service-group-summary">
                        <div class="summary-card">
                            <h3>Total de Horas (Mês)</h3>
                            <p id="serviceGroupTotalHours">0h 0min</p>
                        </div>
                        <div class="summary-card">
                            <h3>Total Faturado (Mês)</h3>
                            <p id="serviceGroupTotalRevenue">R$ 0,00</p>
                        </div>
                        <div class="summary-card" style="background: #fff3cd; border: 2px solid #ffc107;">
                            <h3>Total de Horas (Todos os Meses)</h3>
                            <p id="serviceGroupTotalHoursAll" style="color: #856404; font-size: 1.8rem; font-weight: bold;">0h 0min</p>
                        </div>
                        <div class="summary-card" style="background: #d4edda; border: 2px solid #28a745;">
                            <h3>Total Faturado (Todos os Meses)</h3>
                            <p id="serviceGroupTotalRevenueAll" style="color: #155724; font-size: 1.8rem; font-weight: bold;">R$ 0,00</p>
                        </div>
                    </div>
                    <div class="service-days-container">
                        <h3>Serviços por Dia</h3>
                        <div id="serviceDaysList" class="service-days-list">
                            <!-- Serviços por dia serão inseridos aqui -->
                        </div>
                    </div>
                    <div class="service-items-summary">
                        <h3>Resumo por Serviço</h3>
                        <div id="serviceItemsSummary" class="service-items-summary-list">
                            <!-- Resumo será inserido aqui -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal: Criar/Editar Meta -->
        <div id="goalModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="goalModalTitle">Criar Nova Meta</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <form id="goalForm">
                    <div class="form-group">
                        <label for="goalMonth">Mês/Ano *</label>
                        <input type="month" id="goalMonth" required />
                    </div>
                    <div class="form-group">
                        <label for="goalAmount">Valor da Meta (R$) *</label>
                        <input
                            type="number"
                            id="goalAmount"
                            step="0.01"
                            min="0.01"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="goalDescription">Descrição (opcional)</label>
                        <input type="text" id="goalDescription" placeholder="Ex: Meta de vendas de verão" />
                    </div>
                    <div class="modal-actions">
                        <button
                            type="button"
                            class="btn-secondary"
                            id="cancelGoalBtn"
                        >
                            Cancelar
                        </button>
                        <button type="submit" class="btn-primary">
                            Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal: Visualizar QR Code -->
        <div id="qrcodeModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>QR Code do Produto</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <div style="text-align: center; padding: 2rem;">
                    <canvas id="qrcodeModalCanvas" style="max-width: 100%; height: auto; border: 2px solid var(--border-color); padding: 1rem; background: white;"></canvas>
                    <p id="qrcodeItemName" style="margin-top: 1rem; font-weight: bold; font-size: 1.1rem;"></p>
                    <div style="margin-top: 1.5rem; display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                        <button type="button" class="btn-primary" id="downloadQRModalBtn">
                            <i class="fas fa-download"></i> Baixar QR Code
                        </button>
                        <button type="button" class="btn-secondary" id="printQRModalBtn">
                            <i class="fas fa-print"></i> Imprimir
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // TESTE DIRETO - Escrever no DOM para verificar se JavaScript está executando
            (function() {
                try {
                    // Função para adicionar log (apenas no console agora)
                    function addDebugLog(msg) {
                        if (window.console && console.log) {
                            console.log(msg);
                        }
                    }
                    
                    addDebugLog('Script inline iniciado');
                    
                    function tentarInicializar() {
                        if (typeof LojaApp !== 'undefined') {
                            if (!window.app) {
                                console.log('🟡 [GERENCIAMENTO.HTML] Criando LojaApp via script inline...');
                                try {
                                    window.app = new LojaApp();
                                    console.log('✅ [GERENCIAMENTO.HTML] LojaApp criado com sucesso!');
                                } catch (error) {
                                    console.error('❌ [GERENCIAMENTO.HTML] Erro ao criar LojaApp:', error);
                                }
                            }
                        } else {
                            setTimeout(tentarInicializar, 200);
                        }
                    }
                    
                    if (document.readyState === 'complete' || document.readyState === 'interactive') {
                        setTimeout(tentarInicializar, 100);
                    } else {
                        document.addEventListener('DOMContentLoaded', function() {
                            setTimeout(tentarInicializar, 100);
                        });
                    }
                } catch (error) {
                    // Se houver erro, mostrar no DOM
                    var errorDiv = document.createElement('div');
                    errorDiv.style.cssText = 'position:fixed;top:10px;right:10px;background:red;color:white;padding:10px;z-index:9999;';
                    errorDiv.innerHTML = 'ERRO: ' + error.message;
                    document.body.appendChild(errorDiv);
                }
            })();
        </script>
        <script>
            // Carregar app.js com timestamp para evitar cache
            console.log(
                '🟣 [GERENCIAMENTO.HTML] ========== CARREGANDO APP.JS =========='
            );
            console.log('🟣 [GERENCIAMENTO.HTML] URL atual:', window.location.href);
            console.log('🟣 [GERENCIAMENTO.HTML] Timestamp:', Date.now());
            console.log(
                '🟣 [GERENCIAMENTO.HTML] SessionStorage antes de carregar app.js:',
                {
                    loggedIn: sessionStorage.getItem('loggedIn'),
                    username: sessionStorage.getItem('username'),
                }
            );

            const script = document.createElement('script');
            script.src = '/js/app.js?v=' + Date.now();

            script.onerror = function (e) {
                console.error('❌ [GERENCIAMENTO.HTML] Erro ao carregar app.js!');
                console.error('❌ [GERENCIAMENTO.HTML] Erro:', e);
                console.error('❌ [GERENCIAMENTO.HTML] Tentando carregar de caminho alternativo...');
                // Tentar carregar sem o / inicial (caminho relativo)
                const scriptRetry = document.createElement('script');
                scriptRetry.src = 'js/app.js?v=' + Date.now();
                scriptRetry.onerror = function() {
                    console.error('❌ [GERENCIAMENTO.HTML] Falha ao carregar app.js de ambos os caminhos!');
                };
                scriptRetry.onload = function() {
                    console.log('✅ [GERENCIAMENTO.HTML] app.js carregado com caminho alternativo!');
                    if (typeof LojaApp !== 'undefined' && !window.app) {
                        try {
                            window.app = new LojaApp();
                            console.log('✅ [GERENCIAMENTO.HTML] LojaApp criado após retry!');
                        } catch (error) {
                            console.error('❌ [GERENCIAMENTO.HTML] Erro ao criar LojaApp após retry:', error);
                        }
                    }
                };
                document.head.appendChild(scriptRetry);
            };

            script.onload = function () {
                console.log('✅ [GERENCIAMENTO.HTML] app.js carregado com sucesso!');
                console.log('✅ [GERENCIAMENTO.HTML] LojaApp definido?', typeof LojaApp !== 'undefined');
                
                // Garantir que a aplicação seja inicializada mesmo se DOMContentLoaded já foi disparado
                let tentativas = 0;
                const maxTentativas = 10;
                function tentarInicializarApp() {
                    tentativas++;
                    if (tentativas > maxTentativas) {
                        console.error('❌ [GERENCIAMENTO.HTML] Limite de tentativas excedido. LojaApp não pôde ser carregado.');
                        return;
                    }
                    
                    if (typeof LojaApp !== 'undefined') {
                        if (!window.app) {
                            console.log('🟡 [GERENCIAMENTO.HTML] Criando instância de LojaApp...');
                            try {
                                window.app = new LojaApp();
                                console.log('✅ [GERENCIAMENTO.HTML] LojaApp criado com sucesso!');
                            } catch (error) {
                                console.error('❌ [GERENCIAMENTO.HTML] Erro ao criar LojaApp:', error);
                                console.error('❌ [GERENCIAMENTO.HTML] Stack:', error.stack);
                            }
                        } else {
                            console.log('ℹ️ [GERENCIAMENTO.HTML] LojaApp já existe');
                        }
                    } else {
                        console.warn(`⚠️ [GERENCIAMENTO.HTML] LojaApp ainda não está definido, tentando novamente... (${tentativas}/${maxTentativas})`);
                        setTimeout(tentarInicializarApp, 200);
                    }
                }
                
                if (document.readyState === 'complete' || document.readyState === 'interactive') {
                    console.log('🟡 [GERENCIAMENTO.HTML] DOM já está pronto, inicializando app...');
                    setTimeout(tentarInicializarApp, 100);
                } else {
                    document.addEventListener('DOMContentLoaded', tentarInicializarApp);
                }
            };

            document.head.appendChild(script);
            
            // Também garantir inicialização quando DOMContentLoaded disparar
            document.addEventListener('DOMContentLoaded', function() {
                console.log('🟡 [GERENCIAMENTO.HTML] DOMContentLoaded disparado');
                
                let tentativasDOM = 0;
                const maxTentativasDOM = 10;
                function tentarInicializarApp() {
                    tentativasDOM++;
                    if (tentativasDOM > maxTentativasDOM) {
                        console.error('❌ [GERENCIAMENTO.HTML] Limite de tentativas excedido no DOMContentLoaded. LojaApp não pôde ser carregado.');
                        return;
                    }
                    
                    if (typeof LojaApp !== 'undefined') {
                        if (!window.app) {
                            console.log('🟡 [GERENCIAMENTO.HTML] Criando instância de LojaApp no DOMContentLoaded...');
                            try {
                                window.app = new LojaApp();
                                console.log('✅ [GERENCIAMENTO.HTML] LojaApp criado com sucesso no DOMContentLoaded!');
                            } catch (error) {
                                console.error('❌ [GERENCIAMENTO.HTML] Erro ao criar LojaApp:', error);
                                console.error('❌ [GERENCIAMENTO.HTML] Stack:', error.stack);
                            }
                        } else {
                            console.log('ℹ️ [GERENCIAMENTO.HTML] LojaApp já existe no DOMContentLoaded');
                        }
                    } else {
                        console.warn(`⚠️ [GERENCIAMENTO.HTML] LojaApp ainda não está definido, aguardando... (${tentativasDOM}/${maxTentativasDOM})`);
                        setTimeout(tentarInicializarApp, 200);
                    }
                }
                
                setTimeout(tentarInicializarApp, 200);
            });
        </script>
        <script>
            // Service Worker DESABILITADO temporariamente para evitar cache
            // TODO: Reabilitar quando cache estiver funcionando corretamente
            /*
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('Service Worker registrado:', registration);
                    })
                    .catch((error) => {
                        console.log('Erro ao registrar Service Worker:', error);
                    });
            });
        }
        */

            // Desregistrar qualquer Service Worker existente
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker
                    .getRegistrations()
                    .then(function (registrations) {
                        for (let registration of registrations) {
                            registration.unregister();
                            console.log('Service Worker desregistrado');
                        }
                    });
            }
        </script>

        <!-- Modal: Tutorial / Como usar -->
        <div id="tutorialModal" class="modal">
            <div class="modal-content large">
                <div class="modal-header">
                    <h2>Como usar o sistema</h2>
                    <span class="close" aria-label="Fechar modal" role="button" tabindex="0">&times;</span>
                </div>
                <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                    <div id="tutorialContent">
                        <!-- Conteúdo será inserido via JavaScript -->
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="closeTutorialBtn">Fechar</button>
                    <button type="button" class="btn-primary" id="startTutorialBtn">Iniciar Tutorial Interativo</button>
                </div>
            </div>
        </div>

        <!-- Balões de Tutorial (Tooltips interativos) -->
        <div id="tutorialOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 9998; pointer-events: auto;"></div>
        <div id="tutorialTooltip" style="display: none; position: fixed; z-index: 9999; background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); max-width: 350px; pointer-events: auto;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                <h3 style="margin: 0; color: var(--primary-color); font-size: 1.1rem;">Tutorial</h3>
                <button id="closeTutorialTooltip" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray-600);">&times;</button>
            </div>
            <div id="tutorialTooltipContent" style="margin-bottom: 1rem; color: var(--gray-700); line-height: 1.6;"></div>
            <div style="display: flex; justify-content: space-between; gap: 0.5rem;">
                <button id="tutorialPrevBtn" class="btn-secondary" style="flex: 1;">Anterior</button>
                <button id="tutorialNextBtn" class="btn-primary" style="flex: 1;">Próximo</button>
            </div>
            <div style="margin-top: 0.5rem; text-align: center;">
                <button id="tutorialSkipBtn" class="btn-secondary" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;">Pular Tutorial</button>
            </div>
        </div>
    </body>
</html>


