<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Testes Mobile e PWA</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI',
                    Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                padding: 1rem;
                background: #f5f5f5;
                line-height: 1.6;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
            }

            h1 {
                color: #333;
                margin-bottom: 2rem;
                text-align: center;
            }

            .test-section {
                background: white;
                border-radius: 8px;
                padding: 1.5rem;
                margin-bottom: 1.5rem;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .test-section h2 {
                color: #dc3545;
                margin-bottom: 1rem;
                font-size: 1.25rem;
            }

            .test-item {
                padding: 0.75rem;
                margin-bottom: 0.5rem;
                border-left: 3px solid #ddd;
                background: #f9f9f9;
            }

            .test-item.pass {
                border-left-color: #28a745;
                background: #d4edda;
            }

            .test-item.fail {
                border-left-color: #dc3545;
                background: #f8d7da;
            }

            .test-item.warning {
                border-left-color: #ffc107;
                background: #fff3cd;
            }

            .test-item strong {
                display: block;
                margin-bottom: 0.25rem;
            }

            .test-item small {
                color: #666;
                font-size: 0.85rem;
            }

            .btn {
                background: #dc3545;
                color: white;
                border: none;
                padding: 0.75rem 1.5rem;
                border-radius: 4px;
                cursor: pointer;
                font-size: 1rem;
                margin: 0.5rem 0.5rem 0.5rem 0;
            }

            .btn:hover {
                background: #c82333;
            }

            .btn-secondary {
                background: #6c757d;
            }

            .btn-secondary:hover {
                background: #5a6268;
            }

            .results {
                margin-top: 1rem;
                padding: 1rem;
                background: #f8f9fa;
                border-radius: 4px;
            }

            .metric {
                display: flex;
                justify-content: space-between;
                padding: 0.5rem 0;
                border-bottom: 1px solid #ddd;
            }

            .metric:last-child {
                border-bottom: none;
            }

            .metric-label {
                font-weight: 600;
            }

            .metric-value {
                color: #666;
            }

            @media (max-width: 768px) {
                body {
                    padding: 0.5rem;
                }

                .test-section {
                    padding: 1rem;
                }

                h1 {
                    font-size: 1.5rem;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>üì± Testes Mobile e PWA</h1>

            <div class="test-section">
                <h2>üîç Detec√ß√£o de Dispositivo</h2>
                <div id="deviceTests"></div>
            </div>

            <div class="test-section">
                <h2>üìê Responsividade</h2>
                <div id="responsiveTests"></div>
            </div>

            <div class="test-section">
                <h2>‚ö° PWA - Progressive Web App</h2>
                <div id="pwaTests"></div>
            </div>

            <div class="test-section">
                <h2>üìä M√©tricas de Performance Mobile</h2>
                <div id="performanceTests"></div>
            </div>

            <div class="test-section">
                <h2>üéØ Funcionalidades Touch</h2>
                <div id="touchTests"></div>
            </div>

            <div class="test-section">
                <h2>üì± Testes de Viewport</h2>
                <div id="viewportTests"></div>
            </div>

            <div class="test-section">
                <button class="btn" onclick="runAllTests()">
                    üîÑ Executar Todos os Testes
                </button>
                <button class="btn btn-secondary" onclick="exportResults()">
                    üì• Exportar Resultados
                </button>
            </div>

            <div class="test-section">
                <h2>üìã Resultados</h2>
                <div id="results" class="results"></div>
            </div>
        </div>

        <script>
            const testResults = {
                device: [],
                responsive: [],
                pwa: [],
                performance: [],
                touch: [],
                viewport: [],
            };

            // Detec√ß√£o de dispositivo
            function testDevice() {
                const tests = [];
                const ua = navigator.userAgent;

                // Mobile
                const isMobile =
                    /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
                        ua
                    );
                tests.push({
                    name: 'Dispositivo Mobile Detectado',
                    pass: isMobile,
                    info: isMobile
                        ? 'Dispositivo mobile identificado'
                        : 'Dispositivo desktop',
                });

                // Touch support
                const hasTouch =
                    'ontouchstart' in window || navigator.maxTouchPoints > 0;
                tests.push({
                    name: 'Suporte a Touch',
                    pass: hasTouch,
                    info: hasTouch
                        ? 'Touch dispon√≠vel'
                        : 'Touch n√£o dispon√≠vel',
                });

                // Screen size
                const screenWidth = window.screen.width;
                const screenHeight = window.screen.height;
                tests.push({
                    name: 'Tamanho da Tela',
                    pass: true,
                    info: `${screenWidth}x${screenHeight}px`,
                });

                // Pixel ratio
                const pixelRatio = window.devicePixelRatio || 1;
                tests.push({
                    name: 'Device Pixel Ratio',
                    pass: true,
                    info: `${pixelRatio}x`,
                });

                testResults.device = tests;
                renderTests('deviceTests', tests);
            }

            // Testes de responsividade
            function testResponsive() {
                const tests = [];
                const width = window.innerWidth;
                const height = window.innerHeight;

                // Breakpoints
                const isMobile = width < 768;
                const isTablet = width >= 768 && width < 1024;
                const isDesktop = width >= 1024;

                tests.push({
                    name: 'Largura da Janela',
                    pass: true,
                    info: `${width}px`,
                });

                tests.push({
                    name: 'Altura da Janela',
                    pass: true,
                    info: `${height}px`,
                });

                tests.push({
                    name: 'Breakpoint Mobile (<768px)',
                    pass: isMobile,
                    info: isMobile ? 'Ativo' : 'Inativo',
                });

                tests.push({
                    name: 'Breakpoint Tablet (768-1024px)',
                    pass: isTablet,
                    info: isTablet ? 'Ativo' : 'Inativo',
                });

                tests.push({
                    name: 'Breakpoint Desktop (‚â•1024px)',
                    pass: isDesktop,
                    info: isDesktop ? 'Ativo' : 'Inativo',
                });

                // Viewport meta tag
                const viewportMeta = document.querySelector(
                    'meta[name="viewport"]'
                );
                tests.push({
                    name: 'Meta Viewport Configurado',
                    pass: !!viewportMeta,
                    info: viewportMeta
                        ? viewportMeta.content
                        : 'N√£o encontrado',
                });

                testResults.responsive = tests;
                renderTests('responsiveTests', tests);
            }

            // Testes PWA
            function testPWA() {
                const tests = [];

                // Manifest
                const manifestLink = document.querySelector(
                    'link[rel="manifest"]'
                );
                tests.push({
                    name: 'Manifest.json Link',
                    pass: !!manifestLink,
                    info: manifestLink ? 'Encontrado' : 'N√£o encontrado',
                });

                // Service Worker
                const hasServiceWorker = 'serviceWorker' in navigator;
                tests.push({
                    name: 'Service Worker Suportado',
                    pass: hasServiceWorker,
                    info: hasServiceWorker ? 'Suportado' : 'N√£o suportado',
                });

                // Service Worker registrado
                if (hasServiceWorker) {
                    navigator.serviceWorker
                        .getRegistrations()
                        .then((registrations) => {
                            const registered = registrations.length > 0;
                            tests.push({
                                name: 'Service Worker Registrado',
                                pass: registered,
                                info: registered
                                    ? `${registrations.length} registrado(s)`
                                    : 'N√£o registrado',
                            });
                            testResults.pwa = tests;
                            renderTests('pwaTests', tests);
                        });
                } else {
                    tests.push({
                        name: 'Service Worker Registrado',
                        pass: false,
                        info: 'Service Worker n√£o suportado',
                    });
                }

                // Standalone mode
                const isStandalone =
                    window.matchMedia('(display-mode: standalone)').matches ||
                    window.navigator.standalone ||
                    document.referrer.includes('android-app://');
                tests.push({
                    name: 'Modo Standalone (Instalado)',
                    pass: isStandalone,
                    info: isStandalone ? 'App instalado' : 'Navegador',
                });

                // Install prompt
                let deferredPrompt = null;
                window.addEventListener('beforeinstallprompt', (e) => {
                    deferredPrompt = e;
                });
                tests.push({
                    name: 'Install Prompt Dispon√≠vel',
                    pass: !!deferredPrompt,
                    info: deferredPrompt ? 'Dispon√≠vel' : 'N√£o dispon√≠vel',
                });

                testResults.pwa = tests;
                renderTests('pwaTests', tests);
            }

            // Testes de performance mobile
            function testPerformance() {
                const tests = [];

                // Connection API
                if ('connection' in navigator) {
                    const conn =
                        navigator.connection ||
                        navigator.mozConnection ||
                        navigator.webkitConnection;
                    if (conn) {
                        tests.push({
                            name: 'Tipo de Conex√£o',
                            pass: true,
                            info: conn.effectiveType || 'Desconhecido',
                        });

                        tests.push({
                            name: 'Velocidade de Download',
                            pass: true,
                            info: conn.downlink
                                ? `${conn.downlink} Mbps`
                                : 'Desconhecido',
                        });

                        tests.push({
                            name: 'Economia de Dados',
                            pass: true,
                            info: conn.saveData ? 'Ativado' : 'Desativado',
                        });
                    }
                }

                // Performance API
                if (window.performance) {
                    const timing = window.performance.timing;
                    if (timing) {
                        const loadTime =
                            timing.loadEventEnd - timing.navigationStart;
                        tests.push({
                            name: 'Tempo de Carregamento',
                            pass: loadTime < 3000,
                            info: `${loadTime}ms`,
                        });
                    }

                    // Memory (Chrome)
                    if (performance.memory) {
                        const used = (
                            performance.memory.usedJSHeapSize / 1048576
                        ).toFixed(2);
                        const total = (
                            performance.memory.totalJSHeapSize / 1048576
                        ).toFixed(2);
                        tests.push({
                            name: 'Uso de Mem√≥ria',
                            pass: parseFloat(used) < 50,
                            info: `${used} MB / ${total} MB`,
                        });
                    }
                }

                testResults.performance = tests;
                renderTests('performanceTests', tests);
            }

            // Testes de touch
            function testTouch() {
                const tests = [];

                // Touch events
                const hasTouchEvents = 'ontouchstart' in window;
                tests.push({
                    name: 'Touch Events Suportados',
                    pass: hasTouchEvents,
                    info: hasTouchEvents ? 'Suportado' : 'N√£o suportado',
                });

                // Touch points
                const maxTouchPoints = navigator.maxTouchPoints || 0;
                tests.push({
                    name: 'Pontos de Touch Simult√¢neos',
                    pass: maxTouchPoints > 0,
                    info: `${maxTouchPoints} pontos`,
                });

                // Gestures
                const hasGestures = 'ongesturestart' in window;
                tests.push({
                    name: 'Gestos Suportados',
                    pass: hasGestures,
                    info: hasGestures ? 'Suportado' : 'N√£o suportado',
                });

                testResults.touch = tests;
                renderTests('touchTests', tests);
            }

            // Testes de viewport
            function testViewport() {
                const tests = [];

                const vw = window.innerWidth;
                const vh = window.innerHeight;
                const screenW = window.screen.width;
                const screenH = window.screen.height;

                tests.push({
                    name: 'Viewport Width',
                    pass: true,
                    info: `${vw}px`,
                });

                tests.push({
                    name: 'Viewport Height',
                    pass: true,
                    info: `${vh}px`,
                });

                tests.push({
                    name: 'Screen Width',
                    pass: true,
                    info: `${screenW}px`,
                });

                tests.push({
                    name: 'Screen Height',
                    pass: true,
                    info: `${screenH}px`,
                });

                // Orientation
                const orientation = screen.orientation
                    ? screen.orientation.angle
                    : window.orientation !== undefined
                    ? window.orientation
                    : 'unknown';
                tests.push({
                    name: 'Orienta√ß√£o',
                    pass: true,
                    info: `${orientation}¬∞`,
                });

                testResults.viewport = tests;
                renderTests('viewportTests', tests);
            }

            // Renderizar testes
            function renderTests(containerId, tests) {
                const container = document.getElementById(containerId);
                if (!container) return;

                container.innerHTML = tests
                    .map((test) => {
                        const status = test.pass ? 'pass' : 'fail';
                        return `
                    <div class="test-item ${status}">
                        <strong>${test.name}</strong>
                        <small>${test.info}</small>
                    </div>
                `;
                    })
                    .join('');
            }

            // Executar todos os testes
            function runAllTests() {
                testDevice();
                testResponsive();
                testPWA();
                testPerformance();
                testTouch();
                testViewport();

                // Atualizar resultados
                updateResults();
            }

            // Atualizar resultados
            function updateResults() {
                const results = document.getElementById('results');
                if (!results) return;

                const allTests = [
                    ...testResults.device,
                    ...testResults.responsive,
                    ...testResults.pwa,
                    ...testResults.performance,
                    ...testResults.touch,
                    ...testResults.viewport,
                ];

                const passed = allTests.filter((t) => t.pass).length;
                const total = allTests.length;
                const percentage = ((passed / total) * 100).toFixed(1);

                results.innerHTML = `
                <div class="metric">
                    <span class="metric-label">Total de Testes:</span>
                    <span class="metric-value">${total}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Testes Passados:</span>
                    <span class="metric-value" style="color: #28a745;">${passed}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Testes Falhados:</span>
                    <span class="metric-value" style="color: #dc3545;">${
                        total - passed
                    }</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Taxa de Sucesso:</span>
                    <span class="metric-value" style="color: ${
                        percentage >= 80
                            ? '#28a745'
                            : percentage >= 60
                            ? '#ffc107'
                            : '#dc3545'
                    }; font-weight: bold;">${percentage}%</span>
                </div>
            `;
            }

            // Exportar resultados
            function exportResults() {
                const data = {
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    viewport: {
                        width: window.innerWidth,
                        height: window.innerHeight,
                    },
                    tests: testResults,
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], {
                    type: 'application/json',
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `mobile-pwa-tests-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }

            // Executar testes ao carregar
            window.addEventListener('load', () => {
                setTimeout(runAllTests, 500);
            });

            // Atualizar testes ao redimensionar
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    testResponsive();
                    testViewport();
                    updateResults();
                }, 300);
            });

            // Atualizar orienta√ß√£o
            window.addEventListener('orientationchange', () => {
                setTimeout(() => {
                    testViewport();
                    testResponsive();
                    updateResults();
                }, 500);
            });
        </script>
    </body>
</html>
