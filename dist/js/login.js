function getUserPermissions(e){const o={admin:{read:!0,write:!0,delete:!0,export:!0,import:!0,manageUsers:!0,viewAdmin:!0},manager:{read:!0,write:!0,delete:!0,export:!0,import:!1,manageUsers:!1,viewAdmin:!1},user:{read:!0,write:!0,delete:!1,export:!1,import:!1,manageUsers:!1,viewAdmin:!1}};return o[e]||o.user}console.log("üîµ [LOGIN.JS] Script carregado e executando..."),document.addEventListener("DOMContentLoaded",function(){console.log("üü¢ [LOGIN.JS] DOMContentLoaded disparado"),console.log("üü¢ [LOGIN.JS] Documento pronto, buscando elementos...");const e=document.getElementById("loginForm"),o=document.getElementById("errorMessage"),n=document.getElementById("username"),t=document.getElementById("password");if(console.log("üü¢ [LOGIN.JS] Elementos encontrados:",{loginForm:!!e,errorMessage:!!o,usernameInput:!!n,passwordInput:!!t}),!e)return void console.error("‚ùå [LOGIN.JS] ERRO: Formul√°rio de login n√£o encontrado!");if(!n||!t)return void console.error("‚ùå [LOGIN.JS] ERRO: Campos de input n√£o encontrados!");function a(){const e=localStorage.getItem("loginAttempts");return e?JSON.parse(e):{count:0,lastAttempt:0,blockedUntil:0}}function s(e){localStorage.setItem("loginAttempts",JSON.stringify(e))}function r(){const e=a(),o=Date.now();return o-e.lastAttempt>3e5&&(e.count=0),e.count++,e.lastAttempt=o,e.count>=5?(e.blockedUntil=o+9e5,s(e),{blocked:!0,remainingSeconds:900,message:"Muitas tentativas de login falhadas. Acesso bloqueado por 15 minutos."}):(s(e),{blocked:!1,remainingAttempts:5-e.count})}async function c(e,o){console.log("üü° [LOGIN.JS] Processando login...");const n=function(){const e=a(),o=Date.now();return e.blockedUntil>o?{blocked:!0,remainingSeconds:Math.ceil((e.blockedUntil-o)/1e3)}:(e.blockedUntil>0&&e.blockedUntil<=o&&s({count:0,lastAttempt:0,blockedUntil:0}),{blocked:!1})}();if(n.blocked)return console.warn("‚ö†Ô∏è [LOGIN.JS] Acesso bloqueado por muitas tentativas"),d(`Acesso temporariamente bloqueado. Tente novamente em ${n.remainingSeconds} segundos.`),!1;if(!e||!o)return console.warn("‚ö†Ô∏è [LOGIN.JS] Campos vazios detectados"),d("Por favor, preencha todos os campos."),!1;const c={nilda:{passwordHash:"a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",level:"user"},gabriel:{passwordHash:"8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92",level:"admin"},samara:{passwordHash:"8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92",level:"manager"},admin:{passwordHash:"8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92",level:"admin"},paulo:{passwordHash:"a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",level:"manager"}}[e];if(!c){console.warn("‚ö†Ô∏è [LOGIN.JS] Usu√°rio n√£o encontrado");const e=r();if(e.blocked)d(e.message);else{const o=e.remainingAttempts;d(o<=2?`Usu√°rio ou senha incorretos. ${o} tentativa(s) restante(s) antes do bloqueio.`:"Usu√°rio ou senha incorretos.")}return t.value="",!1}const i=await async function(e){try{const o=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}catch(o){return console.error("Erro ao fazer hash da senha:",o),e}}(o);if(c.passwordHash===i){console.log("‚úÖ [LOGIN.JS] Credenciais v√°lidas!"),localStorage.removeItem("loginAttempts"),sessionStorage.setItem("loggedIn","true"),sessionStorage.setItem("username",e),sessionStorage.setItem("userLevel",c.level||"user");const o=getUserPermissions(c.level);sessionStorage.setItem("userPermissions",JSON.stringify(o)),console.log("‚úÖ [LOGIN.JS] SessionStorage salvo"),console.log("üü° [LOGIN.JS] Redirecionando para /gerenciamento.html..."),console.log("üü° [LOGIN.JS] Redirecionando para gerenciamento.html...");try{window.location.href="/gerenciamento.html",console.log("‚úÖ [LOGIN.JS] window.location.href = /gerenciamento.html executado"),setTimeout(()=>{"/gerenciamento.html"===window.location.pathname||window.location.pathname.includes("gerenciamento")||(console.log("üü° [LOGIN.JS] Tentando caminho relativo..."),window.location.href="gerenciamento.html")},500)}catch(e){console.error("‚ùå [LOGIN.JS] Erro ao redirecionar:",e),window.location.href="gerenciamento.html"}return!0}{console.warn("‚ö†Ô∏è [LOGIN.JS] Credenciais inv√°lidas");const e=r();if(e.blocked)d(e.message);else{const o=e.remainingAttempts;d(o<=2?`Usu√°rio ou senha incorretos. ${o} tentativa(s) restante(s) antes do bloqueio.`:"Usu√°rio ou senha incorretos.")}return t.value="",!1}}function i(){const e=n.value.trim(),a=t.value;o&&(o.classList.remove("show"),o.textContent=""),c(e,a)}console.log("‚úÖ [LOGIN.JS] Todos os elementos encontrados, anexando event listener...");const l=document.getElementById("entrarBtn")||e.querySelector('button[type="submit"]');function d(e){o?(o.textContent=e,o.classList.add("show")):console.error("‚ùå [LOGIN.JS] Erro: elemento errorMessage n√£o encontrado!")}l&&l.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),i()}),console.log("üü¢ [LOGIN.JS] Anexando evento submit ao formul√°rio..."),e.addEventListener("submit",function(e){console.log("üü° [LOGIN.JS] ========== SUBMIT DO FORMUL√ÅRIO =========="),e.preventDefault(),e.stopPropagation(),console.log("üü° [LOGIN.JS] preventDefault e stopPropagation executados"),i()}),console.log("‚úÖ [LOGIN.JS] Event listeners anexados"),console.log("üü¢ [LOGIN.JS] Verificando se usu√°rio j√° est√° logado...");const m="true"===sessionStorage.getItem("loggedIn");if(console.log("üü¢ [LOGIN.JS] Status de login:",m),m){console.log("üü° [LOGIN.JS] Usu√°rio j√° logado, redirecionando...");try{window.location.href="/gerenciamento.html",console.log("‚úÖ [LOGIN.JS] Redirecionamento executado")}catch(e){console.error("‚ùå [LOGIN.JS] Erro ao redirecionar:",e),window.location.href="gerenciamento.html"}}else console.log("‚ÑπÔ∏è [LOGIN.JS] Usu√°rio n√£o est√° logado, aguardando login...");console.log("‚úÖ [LOGIN.JS] Inicializa√ß√£o completa")});